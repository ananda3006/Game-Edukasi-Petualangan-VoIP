<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Petualangan VoIP</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Inter:wght@400;500;600&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #0f0f23 0%, #1a1a3e 50%, #2d1b69 100%);
            color: white;
            overflow-x: hidden;
            min-height: 100vh;
        }
        
        .game-container {
            position: relative;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        .stars {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
        }
        
        .star {
            position: absolute;
            background: white;
            border-radius: 50%;
            animation: twinkle 2s infinite alternate;
        }
        
        @keyframes twinkle {
            0% { opacity: 0.3; }
            100% { opacity: 1; }
        }
        
        .header {
            position: relative;
            z-index: 10;
            text-align: center;
            padding: 2rem;
            background: rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
        }
        
        .game-title {
            font-family: 'Orbitron', monospace;
            font-size: 3rem;
            font-weight: 900;
            background: linear-gradient(45deg, #00f5ff, #ff00ff, #ffff00);
            background-size: 200% 200%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: gradientShift 3s ease-in-out infinite;
            margin-bottom: 0.5rem;
        }
        
        @keyframes gradientShift {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }
        
        .subtitle {
            font-size: 1.2rem;
            color: #00f5ff;
            margin-bottom: 1rem;
        }
        
        .main-content {
            flex: 1;
            position: relative;
            z-index: 10;
            padding: 2rem;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .screen {
            display: none;
            width: 100%;
            max-width: 1000px;
            margin: 0 auto;
        }
        
        .screen.active {
            display: block;
            animation: fadeIn 0.5s ease-in-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .player-setup {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(15px);
            border-radius: 20px;
            padding: 3rem;
            border: 2px solid rgba(0, 245, 255, 0.3);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        }
        
        .form-group {
            margin-bottom: 2rem;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: #00f5ff;
        }
        
        .form-group input, .form-group select {
            width: 100%;
            padding: 1rem;
            border: 2px solid rgba(0, 245, 255, 0.3);
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 1rem;
        }
        
        .form-group input::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }
        
        .avatar-selection {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }
        
        .avatar-option {
            aspect-ratio: 1;
            border: 3px solid transparent;
            border-radius: 15px;
            background: rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .avatar-option:hover, .avatar-option.selected {
            border-color: #00f5ff;
            background: rgba(0, 245, 255, 0.2);
            transform: scale(1.05);
        }
        
        .btn {
            background: linear-gradient(45deg, #00f5ff, #ff00ff);
            border: none;
            padding: 1rem 2rem;
            border-radius: 50px;
            color: white;
            font-weight: 600;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0, 245, 255, 0.3);
        }
        
        .btn:active {
            transform: translateY(0px);
        }
        
        .ai-companion {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            width: 120px;
            height: 120px;
            background: radial-gradient(circle, rgba(0, 245, 255, 0.3), rgba(255, 0, 255, 0.3));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
            animation: float 3s ease-in-out infinite;
            cursor: pointer;
            z-index: 100;
            border: 3px solid rgba(0, 245, 255, 0.5);
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }
        
        .ai-speech {
            position: fixed;
            bottom: 160px;
            right: 2rem;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(15px);
            border-radius: 15px;
            padding: 1.5rem;
            max-width: 300px;
            border: 2px solid rgba(0, 245, 255, 0.3);
            display: none;
            z-index: 101;
        }
        
        .ai-speech.show {
            display: block;
            animation: slideUp 0.3s ease-out;
        }
        
        @keyframes slideUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .level-map {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 2rem;
            margin: 2rem 0;
        }
        
        .level-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(15px);
            border-radius: 20px;
            padding: 2rem;
            border: 2px solid rgba(0, 245, 255, 0.3);
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }
        
        .level-card:hover {
            transform: translateY(-5px);
            border-color: #00f5ff;
            box-shadow: 0 15px 30px rgba(0, 245, 255, 0.2);
        }
        
        .level-card.locked {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .level-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
        }
        
        .level-title {
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: #00f5ff;
        }
        
        .level-description {
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.8);
        }
        
        .game-screen {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(15px);
            border-radius: 20px;
            padding: 3rem;
            border: 2px solid rgba(0, 245, 255, 0.3);
        }
        
        .question-container {
            margin: 2rem 0;
        }
        
        .question {
            font-size: 1.3rem;
            margin-bottom: 2rem;
            color: #00f5ff;
        }
        
        .options {
            display: grid;
            gap: 1rem;
        }
        
        .option {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(0, 245, 255, 0.3);
            border-radius: 10px;
            padding: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .option:hover {
            background: rgba(0, 245, 255, 0.2);
            border-color: #00f5ff;
        }
        
        .option.correct {
            background: rgba(0, 255, 0, 0.3);
            border-color: #00ff00;
        }
        
        .option.incorrect {
            background: rgba(255, 0, 0, 0.3);
            border-color: #ff0000;
        }
        
        .score-display {
            position: fixed;
            top: 2rem;
            left: 2rem;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 1rem;
            border: 2px solid rgba(0, 245, 255, 0.3);
            z-index: 100;
        }
        
        .progress-bar {
            width: 100%;
            height: 10px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 5px;
            margin: 1rem 0;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #00f5ff, #ff00ff);
            width: 0%;
            transition: width 0.5s ease;
        }
        
        .cutscene {
            text-align: center;
            padding: 3rem;
        }
        
        .cutscene-text {
            font-size: 1.5rem;
            line-height: 1.6;
            margin-bottom: 2rem;
            animation: typewriter 3s steps(50) 1s both;
        }
        
        @keyframes typewriter {
            from { width: 0; }
            to { width: 100%; }
        }
        
        .certificate {
            background: linear-gradient(135deg, #1a1a3e, #2d1b69);
            border: 3px solid #00f5ff;
            border-radius: 20px;
            padding: 3rem;
            text-align: center;
            margin: 2rem auto;
            max-width: 600px;
            box-shadow: 0 0 30px rgba(0, 245, 255, 0.5);
            animation: certificateGlow 3s ease-in-out infinite alternate;
        }
        
        @keyframes certificateGlow {
            0% { 
                box-shadow: 0 0 30px rgba(0, 245, 255, 0.5);
                transform: scale(1);
            }
            100% { 
                box-shadow: 0 0 50px rgba(255, 0, 255, 0.7);
                transform: scale(1.02);
            }
        }
        
        .certificate-title {
            font-family: 'Orbitron', monospace;
            font-size: 2rem;
            color: #00f5ff;
            margin-bottom: 1rem;
        }
        
        @media (max-width: 768px) {
            .game-title {
                font-size: 2rem;
            }
            
            .player-setup {
                padding: 2rem;
            }
            
            .ai-companion {
                width: 80px;
                height: 80px;
                font-size: 2rem;
            }
            
            .ai-speech {
                max-width: 250px;
            }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="stars" id="stars"></div>
        
        <header class="header">
            <h1 class="game-title">Petualangan VoIP</h1>
            <p class="subtitle">Sang Penjaga Suara Digital</p>
        </header>
        
        <div class="score-display" id="scoreDisplay" style="display: none;">
            <div>üèÜ Skor: <span id="currentScore">0</span></div>
            <div>‚≠ê Level: <span id="currentLevel">1</span></div>
            <div style="margin-top: 0.5rem;">
                <button id="soundToggle" onclick="toggleSound()" style="background: none; border: none; color: #00f5ff; cursor: pointer; font-size: 1.2rem; margin-right: 0.5rem;">üîä</button>
                <button id="voiceToggle" onclick="toggleAIVoice()" style="background: none; border: none; color: #ff00ff; cursor: pointer; font-size: 1.2rem;" title="Toggle AI Voice">üé§</button>
            </div>
        </div>
        
        <main class="main-content">
            <!-- Setup Screen -->
            <div class="screen active" id="setupScreen">
                <div class="player-setup">
                    <h2 style="text-align: center; margin-bottom: 2rem; color: #00f5ff;">Persiapan Petualangan</h2>
                    
                    <div class="form-group">
                        <label for="playerName">Nama Pemain:</label>
                        <input type="text" id="playerName" placeholder="Masukkan nama kamu">
                    </div>
                    
                    <div class="form-group">
                        <label for="playerClass">Kelas & Jurusan:</label>
                        <select id="playerClass">
                            <option value="">Pilih kelas dan jurusan</option>
                            <option value="XI TKJ 1">XI TKJ 1</option>
                            <option value="XI TKJ 2">XI TKJ 2</option>
                            <option value="XI RPL 1">XI RPL 2</option>
                            <option value="XI RPL 2">XI RPL 2</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>Pilih Avatar:</label>
                        <div class="avatar-selection">
                            <div class="avatar-option" data-avatar="ü§ñ">ü§ñ</div>
                            <div class="avatar-option" data-avatar="üë®‚Äçüíª">üë®‚Äçüíª</div>
                            <div class="avatar-option" data-avatar="üë©‚Äçüíª">üë©‚Äçüíª</div>
                            <div class="avatar-option" data-avatar="ü¶æ">ü¶æ</div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="difficulty">Tingkat Kesulitan:</label>
                        <select id="difficulty">
                            <option value="easy">Mudah</option>
                            <option value="medium">Sedang</option>
                            <option value="hard">Sulit</option>
                        </select>
                    </div>
                    
                    <div style="text-align: center; margin-top: 2rem;">
                        <button class="btn" onclick="playSound('click'); startGame()">Mulai Petualangan</button>
                    </div>
                </div>
            </div>
            
            <!-- Intro Cutscene -->
            <div class="screen" id="introScreen">
                <div class="cutscene">
                    <div class="alert-container" style="background: rgba(255, 0, 0, 0.2); border: 3px solid #ff0000; border-radius: 15px; padding: 2rem; margin-bottom: 2rem; animation: alertPulse 1s infinite;">
                        <h2 style="color: #ff0000; margin-bottom: 1rem; font-size: 2.5rem; text-shadow: 0 0 20px #ff0000; animation: textGlitch 0.5s infinite;">‚ö†Ô∏è SISTEM ERROR KRITIS ‚ö†Ô∏è</h2>
                        <div style="color: #ffff00; font-size: 1.2rem; margin-bottom: 1rem; animation: blink 0.8s infinite;">KONEKSI TERPUTUS - JARINGAN GLOBAL DOWN</div>
                        <div style="color: #ff6666; font-size: 1rem;">STATUS: EMERGENCY PROTOCOL ACTIVATED</div>
                    </div>
                    <div class="cutscene-text" style="color: #ff9999;">
                        <strong style="color: #ff0000;">MAYDAY! MAYDAY!</strong> Dunia komunikasi digital sedang dalam bahaya! "Virus Hening" telah menyerang jaringan VoIP global, memutus semua koneksi suara digital. Sistem keamanan gagal total! Sebagai Guardian of Echo, kamu adalah harapan terakhir untuk memulihkan sistem komunikasi dunia sebelum terlambat!
                    </div>
                    <button class="btn" onclick="playSound('click'); showLevelMap()" style="background: linear-gradient(45deg, #ff0000, #ff6600); animation: buttonPulse 1.5s infinite;">üöÄ TERIMA MISI DARURAT</button>
                </div>
            </div>
            
            <!-- Level Map -->
            <div class="screen" id="levelMapScreen">
                <h2 style="text-align: center; margin-bottom: 2rem; color: #00f5ff;">Peta Petualangan</h2>
                <div class="progress-bar">
                    <div class="progress-fill" id="gameProgress"></div>
                </div>
                
                <div class="level-map">
                    <div class="level-card" onclick="playSound('click'); startLevel(1)" onmouseover="playSound('hover')">
                        <div class="level-icon">üèùÔ∏è</div>
                        <div class="level-title">Level 1: Pulau Suara</div>
                        <div class="level-description">Pelajari dasar-dasar VoIP dan sejarahnya</div>
                    </div>
                    
                    <div class="level-card locked" id="level2" onmouseover="if(!this.classList.contains('locked')) playSound('hover')">
                        <div class="level-icon">üèôÔ∏è</div>
                        <div class="level-title">Level 2: Kota Kabel</div>
                        <div class="level-description">Kenali perangkat keras & lunak VoIP</div>
                    </div>
                    
                    <div class="level-card locked" id="level3" onmouseover="if(!this.classList.contains('locked')) playSound('hover')">
                        <div class="level-icon">üóº</div>
                        <div class="level-title">Level 3: Menara Protokol</div>
                        <div class="level-description">Pahami protokol VoIP dan cara kerjanya</div>
                    </div>
                    
                    <div class="level-card locked" id="level4" onmouseover="if(!this.classList.contains('locked')) playSound('hover')">
                        <div class="level-icon">üè∞</div>
                        <div class="level-title">Level 4: Benteng Keamanan</div>
                        <div class="level-description">Pelajari ancaman dan perlindungan VoIP</div>
                    </div>
                    
                    <div class="level-card locked" id="level5" onmouseover="if(!this.classList.contains('locked')) playSound('hover')">
                        <div class="level-icon">üèõÔ∏è</div>
                        <div class="level-title">Level 5: Aula Aplikasi</div>
                        <div class="level-description">Terapkan VoIP dalam berbagai bidang</div>
                    </div>
                </div>
            </div>
            
            <!-- Game Screen -->
            <div class="screen" id="gameScreen">
                <div class="game-screen">
                    <h2 id="levelTitle" style="text-align: center; color: #00f5ff; margin-bottom: 2rem;"></h2>
                    
                    <div id="materialSection" style="margin-bottom: 2rem;">
                        <h3 style="color: #ff00ff; margin-bottom: 1rem;">üìö Materi Pembelajaran</h3>
                        <div id="materialContent" style="background: rgba(255, 255, 255, 0.1); padding: 1.5rem; border-radius: 10px; margin-bottom: 2rem;"></div>
                    </div>
                    
                    <div class="question-container">
                        <h3 style="color: #ff00ff; margin-bottom: 1rem;">‚ùì Tantangan</h3>
                        <div class="question" id="questionText"></div>
                        <div class="options" id="optionsContainer"></div>
                    </div>
                    
                    <div style="text-align: center; margin-top: 2rem;">
                        <button class="btn" id="nextButton" onclick="playSound('click'); nextQuestion()" style="display: none;">Lanjut</button>
                        <button class="btn" onclick="playSound('click'); showLevelMap()" style="margin-left: 1rem;">Kembali ke Peta</button>
                    </div>
                </div>
            </div>
            
            <!-- Final Screen -->
            <div class="screen" id="finalScreen">
                <div class="cutscene">
                    <h2 style="color: #00ff00; margin-bottom: 2rem;">üéâ MISI BERHASIL! üéâ</h2>
                    <div class="cutscene-text">
                        Selamat! Kamu telah berhasil mengalahkan Virus Hening dan memulihkan jaringan VoIP global. Komunikasi digital kembali normal berkat keahlianmu!
                    </div>
                    
                    <div class="certificate">
                        <div class="certificate-title">üèÜ SERTIFIKAT DIGITAL üèÜ</div>
                        <h3>Guardian of Echo</h3>
                        <p style="margin: 1rem 0;">Diberikan kepada:</p>
                        <h2 id="certificateName" style="color: #00f5ff;"></h2>
                        <p style="margin: 1rem 0;">Sebagai Penjaga Komunikasi Digital Masa Depan</p>
                        <p>Skor Akhir: <span id="finalScore"></span></p>
                    </div>
                    
                    <button class="btn" onclick="playSound('click'); restartGame()">Main Lagi</button>
                </div>
            </div>
        </main>
        
        <!-- AI Companion -->
        <div class="ai-companion" id="aiCompanion" onclick="toggleAISpeech()">
            ü§ñ
        </div>
        
        <div class="ai-speech" id="aiSpeech">
            <div id="aiMessage">Halo! Aku Ananda, AI pendampingmu. Klik aku kapan saja untuk mendapat bantuan!</div>
        </div>
    </div>

    <script>
        // Game State
        let gameState = {
            playerName: '',
            playerClass: '',
            playerAvatar: '',
            difficulty: 'medium',
            currentLevel: 1,
            score: 0,
            completedLevels: [],
            currentQuestionIndex: 0
        };

        // Game Data
        const levels = {
            1: {
                title: "Level 1: Pulau Suara",
                material: "VoIP (Voice over Internet Protocol) adalah teknologi yang memungkinkan komunikasi suara melalui jaringan internet. Teknologi ini pertama kali dikembangkan pada tahun 1995 dan telah merevolusi cara kita berkomunikasi, mengubah panggilan telepon tradisional menjadi data digital yang dapat dikirim melalui internet.",
                questions: [
                    {
                        question: "Apa kepanjangan dari VoIP?",
                        options: ["Voice over Internet Protocol", "Video over Internet Protocol", "Virtual over Internet Protocol", "Voice on Internet Platform"],
                        correct: 0
                    },
                    {
                        question: "Kapan teknologi VoIP pertama kali dikembangkan?",
                        options: ["1990", "1995", "2000", "2005"],
                        correct: 1
                    },
                    {
                        question: "Apa keuntungan utama VoIP dibanding telepon tradisional?",
                        options: ["Lebih mahal", "Kualitas suara lebih buruk", "Biaya lebih murah", "Tidak bisa digunakan"],
                        correct: 2
                    }
                ]
            },
            2: {
                title: "Level 2: Kota Kabel",
                material: "Perangkat VoIP terdiri dari hardware dan software. Hardware meliputi IP Phone (telepon khusus VoIP), Gateway (penghubung jaringan), dan Server VoIP. Software meliputi Softphone (aplikasi telepon di komputer/HP), codec untuk kompresi suara, dan sistem manajemen panggilan.",
                questions: [
                    {
                        question: "Apa fungsi utama Gateway dalam sistem VoIP?",
                        options: ["Menyimpan data", "Menghubungkan jaringan yang berbeda", "Mengompres suara", "Mengatur panggilan"],
                        correct: 1
                    },
                    {
                        question: "Softphone adalah...",
                        options: ["Telepon fisik", "Aplikasi telepon di komputer", "Perangkat keras", "Kabel jaringan"],
                        correct: 1
                    },
                    {
                        question: "Codec dalam VoIP berfungsi untuk...",
                        options: ["Mengatur panggilan", "Mengompres dan dekompresi suara", "Menyimpan kontak", "Mengatur jaringan"],
                        correct: 1
                    }
                ]
            },
            3: {
                title: "Level 3: Menara Protokol",
                material: "Protokol VoIP utama adalah SIP (Session Initiation Protocol) untuk mengatur panggilan, RTP (Real-time Transport Protocol) untuk mengirim data suara, dan H.323 sebagai standar komunikasi multimedia. SIP paling populer karena fleksibel dan mudah diintegrasikan.",
                questions: [
                    {
                        question: "Protokol apa yang digunakan untuk mengatur panggilan VoIP?",
                        options: ["RTP", "SIP", "HTTP", "FTP"],
                        correct: 1
                    },
                    {
                        question: "RTP berfungsi untuk...",
                        options: ["Mengatur panggilan", "Mengirim data suara real-time", "Keamanan", "Kompresi"],
                        correct: 1
                    },
                    {
                        question: "Mengapa SIP lebih populer dari H.323?",
                        options: ["Lebih rumit", "Lebih fleksibel dan mudah diintegrasikan", "Lebih lambat", "Lebih mahal"],
                        correct: 1
                    }
                ]
            },
            4: {
                title: "Level 4: Benteng Keamanan",
                material: "Ancaman VoIP meliputi spam call, DoS attack yang membuat server down, dan penyadapan panggilan. Perlindungan dilakukan dengan enkripsi data suara, firewall untuk memblokir akses tidak sah, VPN untuk koneksi aman, dan sistem autentikasi yang kuat.",
                questions: [
                    {
                        question: "Apa itu DoS attack pada VoIP?",
                        options: ["Panggilan spam", "Serangan yang membuat server tidak dapat diakses", "Penyadapan", "Virus"],
                        correct: 1
                    },
                    {
                        question: "Cara melindungi VoIP dari penyadapan adalah...",
                        options: ["Menggunakan enkripsi", "Mematikan firewall", "Menggunakan password lemah", "Tidak menggunakan VPN"],
                        correct: 0
                    },
                    {
                        question: "Fungsi firewall dalam sistem VoIP adalah...",
                        options: ["Mengompres suara", "Memblokir akses tidak sah", "Mengatur panggilan", "Menyimpan data"],
                        correct: 1
                    }
                ]
            },
            5: {
                title: "Level 5: Aula Aplikasi",
                material: "VoIP diterapkan di berbagai bidang: di rumah untuk panggilan murah, di bisnis untuk sistem telepon kantor, di call center untuk layanan pelanggan, dan di pendidikan untuk pembelajaran jarak jauh. Contoh aplikasi populer: Skype, WhatsApp Call, Zoom, dan Microsoft Teams.",
                questions: [
                    {
                        question: "Contoh penerapan VoIP di bidang pendidikan adalah...",
                        options: ["Call center", "Video conference pembelajaran", "Sistem keamanan", "Game online"],
                        correct: 1
                    },
                    {
                        question: "WhatsApp Call menggunakan teknologi...",
                        options: ["Telepon tradisional", "VoIP", "Radio", "Satelit"],
                        correct: 1
                    },
                    {
                        question: "Keuntungan VoIP untuk bisnis adalah...",
                        options: ["Lebih mahal", "Fitur lebih lengkap dan biaya lebih murah", "Kualitas buruk", "Sulit digunakan"],
                        correct: 1
                    }
                ]
            }
        };

        const aiMessages = {
            welcome: "Halo! Aku Ananda, asisten AI perempuanmu. Selamat datang di EchoQuest! Aku akan membantumu memahami dunia VoIP. Siap memulai petualangan?",
            level1: "Di Pulau Suara, kita akan mempelajari dasar-dasar VoIP. Ingat, VoIP mengubah suara menjadi data digital!",
            level2: "Sekarang kita di Kota Kabel! Di sini kamu akan belajar tentang perangkat-perangkat VoIP. Perhatikan perbedaan hardware dan software ya!",
            level3: "Menara Protokol menanti! Protokol adalah 'bahasa' yang digunakan perangkat VoIP untuk berkomunikasi.",
            level4: "Benteng Keamanan sangat penting! Tanpa keamanan yang baik, sistem VoIP bisa diserang oleh penjahat cyber.",
            level5: "Aula Aplikasi adalah level terakhir! Di sini kamu akan melihat bagaimana VoIP digunakan dalam kehidupan sehari-hari.",
            encouragement: ["Bagus sekali!", "Kamu hebat!", "Terus semangat!", "Jawaban yang tepat!", "Luar biasa!", "Pintar sekali!", "Keren banget!"],
            hints: [
                "Ingat, VoIP sama dengan Voice over Internet Protocol",
                "Pikirkan tentang perangkat yang kamu gunakan sehari-hari",
                "SIP untuk mengatur, RTP untuk mengirim data",
                "Keamanan selalu penting dalam teknologi",
                "VoIP ada di mana-mana di sekitar kita!"
            ],
            victory: "Selamat! Kamu berhasil menyelesaikan semua level! Kamu benar-benar Guardian of Echo yang hebat! Aku Ananda bangga padamu!",
            levelComplete: "Level selesai! Kamu semakin pintar dalam memahami VoIP!"
        };

        // Initialize game
        function initGame() {
            createStars();
            initAIVoice();
            showAIMessage(aiMessages.welcome);
            // Start with gentle menu music on setup screen
            setTimeout(() => startBackgroundMusic('menu'), 1000);
        }

        function createStars() {
            const starsContainer = document.getElementById('stars');
            for (let i = 0; i < 100; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                star.style.left = Math.random() * 100 + '%';
                star.style.top = Math.random() * 100 + '%';
                star.style.width = Math.random() * 3 + 1 + 'px';
                star.style.height = star.style.width;
                star.style.animationDelay = Math.random() * 2 + 's';
                starsContainer.appendChild(star);
            }
        }

        // Avatar selection
        document.querySelectorAll('.avatar-option').forEach(option => {
            option.addEventListener('click', function() {
                document.querySelectorAll('.avatar-option').forEach(opt => opt.classList.remove('selected'));
                this.classList.add('selected');
                gameState.playerAvatar = this.dataset.avatar;
            });
        });

        function startGame() {
            const name = document.getElementById('playerName').value;
            const playerClass = document.getElementById('playerClass').value;
            const difficulty = document.getElementById('difficulty').value;

            if (!name || !playerClass || !gameState.playerAvatar) {
                alert('Mohon lengkapi semua data!');
                return;
            }

            gameState.playerName = name;
            gameState.playerClass = playerClass;
            gameState.difficulty = difficulty;

            showScreen('introScreen');
            playSound('start');
            startBackgroundMusic('intro');
        }

        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            document.getElementById(screenId).classList.add('active');

            if (screenId !== 'setupScreen') {
                document.getElementById('scoreDisplay').style.display = 'block';
                updateScoreDisplay();
            }
        }

        function showLevelMap() {
            showScreen('levelMapScreen');
            updateProgress();
            updateLevelAccess();
            startBackgroundMusic('menu');
        }

        function updateProgress() {
            const progress = (gameState.completedLevels.length / 5) * 100;
            document.getElementById('gameProgress').style.width = progress + '%';
        }

        function updateLevelAccess() {
            for (let i = 2; i <= 5; i++) {
                const levelCard = document.getElementById(`level${i}`);
                if (gameState.completedLevels.includes(i - 1)) {
                    levelCard.classList.remove('locked');
                    levelCard.onclick = () => {
                        playSound('click');
                        startLevel(i);
                    };
                }
            }
        }

        function startLevel(levelNum) {
            if (levelNum > 1 && !gameState.completedLevels.includes(levelNum - 1)) {
                return;
            }

            gameState.currentLevel = levelNum;
            gameState.currentQuestionIndex = 0;
            
            showScreen('gameScreen');
            loadLevel(levelNum);
            showAIMessage(aiMessages[`level${levelNum}`]);
            playSound('levelStart');
            startBackgroundMusic(`level${levelNum}`);
        }

        function loadLevel(levelNum) {
            const level = levels[levelNum];
            document.getElementById('levelTitle').textContent = level.title;
            document.getElementById('materialContent').textContent = level.material;
            
            loadQuestion();
        }

        function loadQuestion() {
            const level = levels[gameState.currentLevel];
            const question = level.questions[gameState.currentQuestionIndex];
            
            document.getElementById('questionText').textContent = question.question;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            
            question.options.forEach((option, index) => {
                const optionDiv = document.createElement('div');
                optionDiv.className = 'option';
                optionDiv.textContent = option;
                optionDiv.onclick = () => {
                    playSound('click');
                    selectAnswer(index);
                };
                optionDiv.onmouseover = () => playSound('hover');
                optionsContainer.appendChild(optionDiv);
            });
            
            document.getElementById('nextButton').style.display = 'none';
        }

        function selectAnswer(selectedIndex) {
            const level = levels[gameState.currentLevel];
            const question = level.questions[gameState.currentQuestionIndex];
            const options = document.querySelectorAll('.option');
            
            options.forEach((option, index) => {
                option.onclick = null;
                if (index === question.correct) {
                    option.classList.add('correct');
                } else if (index === selectedIndex) {
                    option.classList.add('incorrect');
                }
            });
            
            if (selectedIndex === question.correct) {
                gameState.score += getDifficultyMultiplier() * 10;
                playSound('correct');
                showAIMessage(aiMessages.encouragement[Math.floor(Math.random() * aiMessages.encouragement.length)]);
            } else {
                playSound('incorrect');
                showAIMessage("Jangan menyerah! " + aiMessages.hints[gameState.currentLevel - 1]);
            }
            
            updateScoreDisplay();
            document.getElementById('nextButton').style.display = 'inline-block';
        }

        function nextQuestion() {
            gameState.currentQuestionIndex++;
            const level = levels[gameState.currentLevel];
            
            if (gameState.currentQuestionIndex >= level.questions.length) {
                completeLevel();
            } else {
                loadQuestion();
            }
        }

        function completeLevel() {
            if (!gameState.completedLevels.includes(gameState.currentLevel)) {
                gameState.completedLevels.push(gameState.currentLevel);
            }
            
            if (gameState.currentLevel === 5) {
                showFinalScreen();
            } else {
                showLevelMap();
                showAIMessage(aiMessages.levelComplete + ` Lanjut ke level berikutnya!`);
            }
            
            playSound('levelComplete');
        }

        function showFinalScreen() {
            showScreen('finalScreen');
            document.getElementById('certificateName').textContent = gameState.playerName;
            document.getElementById('finalScore').textContent = gameState.score;
            
            // Start victory celebration
            createBirthdayConfetti();
            playVictoryMelody();
            startBackgroundMusic('victory');
            showAIMessage(aiMessages.victory);
        }

        function getDifficultyMultiplier() {
            switch (gameState.difficulty) {
                case 'easy': return 1;
                case 'medium': return 1.5;
                case 'hard': return 2;
                default: return 1;
            }
        }

        function updateScoreDisplay() {
            document.getElementById('currentScore').textContent = gameState.score;
            document.getElementById('currentLevel').textContent = gameState.currentLevel;
        }

        function toggleAISpeech() {
            const aiSpeech = document.getElementById('aiSpeech');
            aiSpeech.classList.toggle('show');
        }

        function showAIMessage(message) {
            document.getElementById('aiMessage').textContent = message;
            const aiSpeech = document.getElementById('aiSpeech');
            aiSpeech.classList.add('show');
            
            // Speak the message with AI voice
            speakAIMessage(message);
            
            setTimeout(() => {
                aiSpeech.classList.remove('show');
            }, 4000);
        }

        // Audio System
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();
        let backgroundMusic = null;
        
        // AI Voice System
        let aiVoice = null;
        let speechSynthesis = window.speechSynthesis;
        
        function initAIVoice() {
            // Wait for voices to load
            if (speechSynthesis.getVoices().length === 0) {
                speechSynthesis.addEventListener('voiceschanged', () => {
                    setupAIVoice();
                });
            } else {
                setupAIVoice();
            }
        }
        
        function setupAIVoice() {
            const voices = speechSynthesis.getVoices();
            
            // Priority order for most natural female voices
            const preferredVoices = [
                // Indonesian voices first
                'Google Bahasa Indonesia',
                'Microsoft Gadis - Indonesian (Indonesia)',
                'Indonesian Female',
                // High quality English female voices
                'Google UK English Female',
                'Microsoft Zira - English (United States)',
                'Microsoft Hazel - English (Great Britain)',
                'Google US English Female',
                'Samantha',
                'Victoria',
                'Serena',
                'Karen',
                'Moira',
                'Tessa',
                'Veena',
                'Fiona'
            ];
            
            // Try to find the best voice in order of preference
            for (const preferredName of preferredVoices) {
                aiVoice = voices.find(voice => 
                    voice.name.includes(preferredName) || 
                    voice.name.toLowerCase().includes(preferredName.toLowerCase())
                );
                if (aiVoice) break;
            }
            
            // Fallback: find any female voice
            if (!aiVoice) {
                aiVoice = voices.find(voice => 
                    voice.name.toLowerCase().includes('female') || 
                    voice.name.toLowerCase().includes('woman') ||
                    voice.name.toLowerCase().includes('zira') ||
                    voice.name.toLowerCase().includes('hazel') ||
                    voice.name.toLowerCase().includes('samantha') ||
                    voice.name.toLowerCase().includes('karen') ||
                    voice.name.toLowerCase().includes('serena') ||
                    voice.gender === 'female'
                ) || voices[0];
            }
            
            console.log('Ananda AI Voice selected:', aiVoice?.name || 'Default');
        }
        
        function speakAIMessage(text, rate = 1.0, pitch = 1.0) {
            if (!soundEnabled || !voiceEnabled || !text) return;
            
            // Stop any current speech
            speechSynthesis.cancel();
            
            const utterance = new SpeechSynthesisUtterance(text);
            
            if (aiVoice) {
                utterance.voice = aiVoice;
            }
            
            // Natural human-like settings
            utterance.rate = rate; // Normal speaking speed
            utterance.pitch = pitch; // Natural pitch, not artificially high
            utterance.volume = 0.9; // Clear volume
            
            // Add some personality to the AI voice
            utterance.onstart = () => {
                const aiCompanion = document.getElementById('aiCompanion');
                aiCompanion.style.animation = 'none';
                aiCompanion.style.animation = 'float 0.5s ease-in-out infinite alternate';
            };
            
            utterance.onend = () => {
                const aiCompanion = document.getElementById('aiCompanion');
                aiCompanion.style.animation = 'float 3s ease-in-out infinite';
            };
            
            speechSynthesis.speak(utterance);
        }
        
        function createTone(frequency, duration, type = 'sine') {
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator.frequency.setValueAtTime(frequency, audioContext.currentTime);
            oscillator.type = type;
            
            gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + duration);
            
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + duration);
        }
        
        function playMelody(notes, duration = 0.2) {
            notes.forEach((note, index) => {
                setTimeout(() => {
                    createTone(note, duration);
                }, index * duration * 1000);
            });
        }
        
        function playSound(type) {
            if (!soundEnabled) return;
            
            // Resume audio context if suspended (required by browsers)
            if (audioContext.state === 'suspended') {
                audioContext.resume();
            }
            
            const aiCompanion = document.getElementById('aiCompanion');
            aiCompanion.style.transform = 'scale(1.2)';
            setTimeout(() => {
                aiCompanion.style.transform = 'scale(1)';
            }, 200);
            
            switch(type) {
                case 'start':
                    playMelody([523, 659, 784, 1047], 0.3); // C-E-G-C melody
                    break;
                case 'correct':
                    playMelody([659, 784, 1047], 0.15); // Success sound
                    break;
                case 'incorrect':
                    createTone(220, 0.5, 'sawtooth'); // Error buzz
                    break;
                case 'levelStart':
                    playMelody([392, 523, 659], 0.25); // Level start
                    break;
                case 'levelComplete':
                    playMelody([523, 659, 784, 1047, 1319], 0.2); // Victory fanfare
                    break;
                case 'victory':
                    playMelody([523, 659, 784, 1047, 1319, 1568, 2093], 0.3); // Final victory
                    break;
                case 'click':
                    createTone(800, 0.1); // Button click
                    break;
                case 'hover':
                    createTone(600, 0.05); // Hover sound
                    break;
            }
        }
        
        // Background Music System
        let currentMusicTheme = null;
        let musicIntervals = [];
        
        const musicThemes = {
            intro: {
                name: "Virus Hening Alert",
                frequencies: [110, 146, 185, 220], // Very dark, ominous tones
                pattern: [0, 3, 1, 2, 0, 3, 2, 1, 0], // Irregular, threatening pattern
                tempo: 1200, // Much faster for tension
                filter: 400, // Lower filter for darker sound
                volume: 0.06, // Louder for impact
                dissonance: true // Add dissonant harmonies
            },
            menu: {
                name: "Digital Horizon",
                frequencies: [261, 329, 392, 523], // C major - hopeful
                pattern: [0, 1, 2, 1, 0, 2, 3, 2], // Flowing pattern
                tempo: 3000,
                filter: 1000,
                volume: 0.04
            },
            level1: {
                name: "Island Waves",
                frequencies: [174, 220, 261, 329], // Calm, oceanic
                pattern: [0, 2, 1, 3, 2, 0], // Wave-like pattern
                tempo: 4000,
                filter: 800,
                volume: 0.035
            },
            level2: {
                name: "Urban Pulse",
                frequencies: [196, 247, 294, 370], // Mechanical, urban
                pattern: [0, 1, 0, 2, 1, 3, 2], // Rhythmic pattern
                tempo: 2500,
                filter: 700,
                volume: 0.04
            },
            level3: {
                name: "Tower Resonance",
                frequencies: [146, 185, 220, 277], // Deep, resonant
                pattern: [3, 2, 1, 0, 1, 2], // Ascending/descending
                tempo: 3500,
                filter: 900,
                volume: 0.038
            },
            level4: {
                name: "Fortress Defense",
                frequencies: [110, 138, 165, 207], // Dark, protective
                pattern: [0, 3, 1, 2, 3, 0, 2], // Defensive pattern
                tempo: 2200,
                filter: 500,
                volume: 0.042
            },
            level5: {
                name: "Hall of Applications",
                frequencies: [293, 369, 440, 554], // Bright, triumphant
                pattern: [0, 1, 2, 3, 2, 1, 0, 2], // Celebratory
                tempo: 2800,
                filter: 1200,
                volume: 0.045
            },
            victory: {
                name: "Digital Victory",
                frequencies: [523, 659, 784, 1047], // High, victorious
                pattern: [0, 1, 2, 3, 2, 1, 3, 0], // Victory fanfare
                tempo: 1800,
                filter: 1500,
                volume: 0.05
            }
        };
        
        function startBackgroundMusic(theme = 'menu') {
            stopBackgroundMusic();
            
            if (!soundEnabled) return;
            
            currentMusicTheme = theme;
            const musicData = musicThemes[theme];
            let patternIndex = 0;
            
            const playThemeNote = () => {
                if (audioContext.state === 'suspended' || !soundEnabled) return;
                
                const frequency = musicData.frequencies[musicData.pattern[patternIndex]];
                
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                const filter = audioContext.createBiquadFilter();
                
                oscillator.connect(filter);
                filter.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.setValueAtTime(frequency, audioContext.currentTime);
                oscillator.type = 'sine';
                
                filter.type = 'lowpass';
                filter.frequency.setValueAtTime(musicData.filter, audioContext.currentTime);
                
                gainNode.gain.setValueAtTime(0, audioContext.currentTime);
                gainNode.gain.linearRampToValueAtTime(musicData.volume, audioContext.currentTime + 0.5);
                gainNode.gain.linearRampToValueAtTime(0, audioContext.currentTime + 3);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 3);
                
                patternIndex = (patternIndex + 1) % musicData.pattern.length;
            };
            
            // Play first note immediately
            playThemeNote();
            
            // Set up interval for continuous music
            const musicInterval = setInterval(() => {
                if (currentMusicTheme === theme && soundEnabled) {
                    playThemeNote();
                } else {
                    clearInterval(musicInterval);
                }
            }, musicData.tempo);
            
            musicIntervals.push(musicInterval);
            
            // Add ambient harmony every few notes
            const harmonyInterval = setInterval(() => {
                if (currentMusicTheme === theme && soundEnabled && Math.random() > 0.6) {
                    const harmonyFreq = musicData.frequencies[Math.floor(Math.random() * musicData.frequencies.length)] * 0.5;
                    
                    const oscillator = audioContext.createOscillator();
                    const gainNode = audioContext.createGain();
                    
                    oscillator.connect(gainNode);
                    gainNode.connect(audioContext.destination);
                    
                    oscillator.frequency.setValueAtTime(harmonyFreq, audioContext.currentTime);
                    oscillator.type = 'triangle';
                    
                    gainNode.gain.setValueAtTime(0, audioContext.currentTime);
                    gainNode.gain.linearRampToValueAtTime(musicData.volume * 0.3, audioContext.currentTime + 1);
                    gainNode.gain.linearRampToValueAtTime(0, audioContext.currentTime + 4);
                    
                    oscillator.start(audioContext.currentTime);
                    oscillator.stop(audioContext.currentTime + 4);
                }
            }, musicData.tempo * 2);
            
            // Add special tension effects for intro/warning theme
            if (theme === 'intro' && musicData.dissonance) {
                const tensionInterval = setInterval(() => {
                    if (currentMusicTheme === theme && soundEnabled && Math.random() > 0.5) {
                        // Create dissonant warning sound
                        const baseFreq = 120;
                        const dissonantFreq = baseFreq * 1.414; // Tritone interval (devil's interval)
                        
                        [baseFreq, dissonantFreq].forEach((freq, index) => {
                            const oscillator = audioContext.createOscillator();
                            const gainNode = audioContext.createGain();
                            const filter = audioContext.createBiquadFilter();
                            
                            oscillator.connect(filter);
                            filter.connect(gainNode);
                            gainNode.connect(audioContext.destination);
                            
                            oscillator.frequency.setValueAtTime(freq, audioContext.currentTime);
                            oscillator.type = 'sawtooth'; // Harsh sound for warning
                            
                            filter.type = 'lowpass';
                            filter.frequency.setValueAtTime(250 + Math.random() * 150, audioContext.currentTime);
                            filter.Q.setValueAtTime(5, audioContext.currentTime); // High resonance for piercing sound
                            
                            gainNode.gain.setValueAtTime(0, audioContext.currentTime);
                            gainNode.gain.linearRampToValueAtTime(0.12, audioContext.currentTime + 0.05);
                            gainNode.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + 1.5);
                            
                            oscillator.start(audioContext.currentTime + index * 0.03);
                            oscillator.stop(audioContext.currentTime + 1.5);
                        });
                    }
                }, musicData.tempo * 0.8);
                
                musicIntervals.push(tensionInterval);
                
                // Add random glitch effects for virus theme
                const glitchInterval = setInterval(() => {
                    if (currentMusicTheme === theme && soundEnabled && Math.random() > 0.7) {
                        const glitchFreq = 60 + Math.random() * 120;
                        
                        const oscillator = audioContext.createOscillator();
                        const gainNode = audioContext.createGain();
                        const filter = audioContext.createBiquadFilter();
                        
                        oscillator.connect(filter);
                        filter.connect(gainNode);
                        gainNode.connect(audioContext.destination);
                        
                        oscillator.frequency.setValueAtTime(glitchFreq, audioContext.currentTime);
                        oscillator.type = 'square'; // Digital glitch sound
                        
                        filter.type = 'highpass';
                        filter.frequency.setValueAtTime(200, audioContext.currentTime);
                        
                        gainNode.gain.setValueAtTime(0, audioContext.currentTime);
                        gainNode.gain.linearRampToValueAtTime(0.15, audioContext.currentTime + 0.01);
                        gainNode.gain.linearRampToValueAtTime(0, audioContext.currentTime + 0.08);
                        
                        oscillator.start(audioContext.currentTime);
                        oscillator.stop(audioContext.currentTime + 0.08);
                    }
                }, 400); // More frequent glitches
                
                musicIntervals.push(glitchInterval);
                
                // Add deep bass rumble for ominous feeling
                const bassInterval = setInterval(() => {
                    if (currentMusicTheme === theme && soundEnabled && Math.random() > 0.8) {
                        const bassFreq = 40 + Math.random() * 30;
                        
                        const oscillator = audioContext.createOscillator();
                        const gainNode = audioContext.createGain();
                        
                        oscillator.connect(gainNode);
                        gainNode.connect(audioContext.destination);
                        
                        oscillator.frequency.setValueAtTime(bassFreq, audioContext.currentTime);
                        oscillator.type = 'sine';
                        
                        gainNode.gain.setValueAtTime(0, audioContext.currentTime);
                        gainNode.gain.linearRampToValueAtTime(0.08, audioContext.currentTime + 0.5);
                        gainNode.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + 3);
                        
                        oscillator.start(audioContext.currentTime);
                        oscillator.stop(audioContext.currentTime + 3);
                    }
                }, musicData.tempo * 2);
                
                musicIntervals.push(bassInterval);
            }
            
            musicIntervals.push(harmonyInterval);
        }
        
        function stopBackgroundMusic() {
            currentMusicTheme = null;
            musicIntervals.forEach(interval => clearInterval(interval));
            musicIntervals = [];
        }

        let soundEnabled = true;
        let voiceEnabled = true;
        
        function toggleSound() {
            soundEnabled = !soundEnabled;
            const soundToggle = document.getElementById('soundToggle');
            soundToggle.textContent = soundEnabled ? 'üîä' : 'üîá';
            
            if (!soundEnabled) {
                stopBackgroundMusic();
                speechSynthesis.cancel(); // Stop any current speech
            } else {
                // Resume appropriate music based on current screen
                const activeScreen = document.querySelector('.screen.active').id;
                if (activeScreen === 'setupScreen' || activeScreen === 'levelMapScreen') {
                    startBackgroundMusic('menu');
                } else if (activeScreen === 'introScreen') {
                    startBackgroundMusic('intro');
                } else if (activeScreen === 'gameScreen') {
                    startBackgroundMusic(`level${gameState.currentLevel}`);
                } else if (activeScreen === 'finalScreen') {
                    startBackgroundMusic('victory');
                }
            }
        }
        
        function toggleAIVoice() {
            voiceEnabled = !voiceEnabled;
            const voiceToggle = document.getElementById('voiceToggle');
            voiceToggle.textContent = voiceEnabled ? 'üé§' : 'üîá';
            
            if (!voiceEnabled) {
                speechSynthesis.cancel(); // Stop any current speech
            }
        }
        
        function restartGame() {
            gameState = {
                playerName: '',
                playerClass: '',
                playerAvatar: '',
                difficulty: 'medium',
                currentLevel: 1,
                score: 0,
                completedLevels: [],
                currentQuestionIndex: 0
            };
            
            // Reset level access
            for (let i = 2; i <= 5; i++) {
                const levelCard = document.getElementById(`level${i}`);
                levelCard.classList.add('locked');
                levelCard.onclick = null;
            }
            
            stopBackgroundMusic();
            showScreen('setupScreen');
            document.getElementById('scoreDisplay').style.display = 'none';
        }

        // Birthday Celebration Functions
        function createBirthdayConfetti() {
            const colors = ['#ff00ff', '#00f5ff', '#ffff00', '#ff0080', '#00ff80', '#8000ff'];
            
            for (let i = 0; i < 50; i++) {
                setTimeout(() => {
                    const confetti = document.createElement('div');
                    confetti.innerHTML = ['üéä', 'üéâ', '‚ú®', 'üåü', 'üí´'][Math.floor(Math.random() * 5)];
                    confetti.style.cssText = `
                        position: fixed;
                        top: -50px;
                        left: ${Math.random() * 100}%;
                        font-size: ${Math.random() * 20 + 20}px;
                        z-index: 999;
                        pointer-events: none;
                        animation: confettiFall ${Math.random() * 3 + 2}s linear forwards;
                    `;
                    
                    document.body.appendChild(confetti);
                    
                    setTimeout(() => {
                        confetti.remove();
                    }, 5000);
                }, i * 100);
            }
            
            // Add CSS animation for confetti
            if (!document.getElementById('confettiStyle')) {
                const style = document.createElement('style');
                style.id = 'confettiStyle';
                style.textContent = `
                    @keyframes confettiFall {
                        to {
                            transform: translateY(100vh) rotate(720deg);
                            opacity: 0;
                        }
                    }
                    @keyframes pulse {
                        0%, 100% { transform: translate(-50%, -50%) scale(1); }
                        50% { transform: translate(-50%, -50%) scale(1.1); }
                    }
                `;
                document.head.appendChild(style);
            }
        }
        
        function createFireworks() {
            const colors = ['#ff00ff', '#00f5ff', '#ffff00', '#ff0080', '#00ff80'];
            
            for (let i = 0; i < 12; i++) {
                setTimeout(() => {
                    const firework = document.createElement('div');
                    const color = colors[Math.floor(Math.random() * colors.length)];
                    
                    firework.style.cssText = `
                        position: fixed;
                        top: ${Math.random() * 50 + 20}%;
                        left: ${Math.random() * 80 + 10}%;
                        width: 4px;
                        height: 4px;
                        background: ${color};
                        border-radius: 50%;
                        z-index: 998;
                        pointer-events: none;
                    `;
                    
                    document.body.appendChild(firework);
                    
                    // Create explosion effect
                    setTimeout(() => {
                        for (let j = 0; j < 8; j++) {
                            const spark = document.createElement('div');
                            const angle = (j * 45) * Math.PI / 180;
                            const distance = Math.random() * 100 + 50;
                            
                            spark.style.cssText = `
                                position: absolute;
                                top: 0;
                                left: 0;
                                width: 3px;
                                height: 3px;
                                background: ${color};
                                border-radius: 50%;
                                animation: sparkFly 1s ease-out forwards;
                                transform: translate(${Math.cos(angle) * distance}px, ${Math.sin(angle) * distance}px);
                            `;
                            
                            firework.appendChild(spark);
                        }
                        
                        setTimeout(() => {
                            firework.remove();
                        }, 1500);
                    }, 100);
                }, i * 300);
            }
            
            // Add spark animation
            if (!document.getElementById('fireworkStyle')) {
                const style = document.createElement('style');
                style.id = 'fireworkStyle';
                style.textContent = `
                    @keyframes sparkFly {
                        0% { opacity: 1; transform: scale(1); }
                        100% { opacity: 0; transform: scale(0.5); }
                    }
                `;
                document.head.appendChild(style);
            }
        }
        
        function playVictoryMelody() {
            if (!soundEnabled) return;
            
            // Epic victory fanfare melody
            const victoryNotes = [
                523, 659, 784, 1047, // Rising triumph
                1047, 932, 784, 659, // Descending power
                523, 659, 784, 1047, 1319, // Building excitement  
                1047, 784, 659, 523, // Resolution
                392, 523, 659, 784, 1047, 1319, 1568, // Final crescendo
                2093, 1568, 1319, 1047, 784, 659, 523 // Grand finale
            ];
            
            victoryNotes.forEach((note, index) => {
                setTimeout(() => {
                    createTone(note, 0.35, 'sine');
                    // Add harmony for richer sound
                    if (index % 2 === 0) {
                        createTone(note * 0.75, 0.35, 'triangle');
                    }
                }, index * 250);
            });
            
            // Add fireworks during the melody
            setTimeout(() => {
                createFireworks();
            }, 1500);
            
            // Add triumphant chord at the end
            setTimeout(() => {
                [523, 659, 784, 1047].forEach(freq => {
                    createTone(freq, 1.5, 'sine');
                });
            }, victoryNotes.length * 250);
        }

        // Initialize the game when page loads
        window.onload = initGame;
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'972e926e134be9d9',t:'MTc1NTgyNTg4MS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
